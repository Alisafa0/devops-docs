---
# tasks file for basic

- name: Install Azabbix and Requirment
  apt:
    name:
      - zabbix-server-pgsql
      - zabbix-frontend-php
      - php8.3-pgsql
      - zabbix-apache-conf
      - zabbix-sql-scripts
      - zabbix-agent
      - postgresql
      - postgresql-contrib
    state: present
  when: ansible_facts['os_family'] == "Debian"

- name: Config Database postgresql
  command:
    - sudo -u postgres createuser --pwprompt zabbix
    - sudo -u postgres createdb -O zabbix zabbix
    - zcat /usr/share/zabbix-sql-scripts/postgresql/server.sql.gz | sudo -u zabbix psql zabbix

- name: Add Password in Database Config File
  lineinfile:
    path: "{{ db }}"
    regexp: '^# DBPassword='
    line: 'DBPassword=Xx@123456'
    owner: root
    group: root
    mode: 0644

- name: Restart zabbix services
  service:
    name:
      - zabbix-server
      - zabbix-agent
      - apache2
    state: restarted
    enabled: yes
